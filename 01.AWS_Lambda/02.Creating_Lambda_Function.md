# Creating Lambda Function

Creating your first AWS Lambda function involves a series of steps, from setting up your AWS account to deploying and testing your function. Here’s a step-by-step guide:

### Step 1: Set Up Your AWS Account
If you don’t already have an AWS account, you need to create one. Visit the [AWS website](https://aws.amazon.com/) and sign up.

### Step 2: Create an IAM Role
Lambda functions require an execution role that grants them permission to access AWS services and resources.

1. Go to the [IAM console](https://console.aws.amazon.com/iam/).
2. Select **Roles** from the sidebar and click **Create role**.
3. Choose **Lambda** as the trusted entity and click **Next: Permissions**.
4. Attach the **AWSLambdaBasicExecutionRole** policy to grant basic execution permissions.
5. Give your role a name and create it.

### Step 3: Create a Lambda Function
1. Navigate to the [AWS Lambda console](https://console.aws.amazon.com/lambda/).
2. Click on **Create function**.
3. Choose **Author from scratch**.
4. Configure the following settings:
   - **Function name**: Give your function a name (e.g., `HelloWorldFunction`).
   - **Runtime**: Choose your preferred runtime (e.g., Python, Node.js).
   - **Role**: Choose the IAM role you created earlier.

### Step 4: Write Your Function Code
You can write your Lambda function code directly in the AWS Management Console or upload it from a file. Here’s an example of a simple Python function:

```python
def lambda_handler(event, context):
    return {
        'statusCode': 200,
        'body': 'Hello, World!'
    }
```

1. In the **Function code** section, paste your code into the editor.
2. Click **Deploy** to save your changes.

### Step 5: Configure a Trigger
A trigger is an event source that invokes your Lambda function. For simplicity, you can use a test event.

1. In the **Function overview** section, click **Add trigger**.
2. Choose the trigger type (e.g., API Gateway, S3).
3. Configure the trigger settings as needed.

### Step 6: Test Your Lambda Function
1. In the **Function code** section, click on **Test**.
2. Configure a test event:
   - Select **Create new test event**.
   - Give the event a name and configure the event JSON (you can use the default).
3. Click **Create** and then **Test**.

You should see the output of your Lambda function in the **Execution result** section.

### Step 7: Monitor and Manage Your Lambda Function
Use the AWS Management Console to monitor and manage your Lambda function. You can view logs, monitor performance, and make adjustments as needed.

That’s it! You’ve created and tested your first AWS Lambda function. From here, you can explore more advanced features and integrations to build more complex serverless applications.


### Demo
<b> Create lambda function to stop EC2 instance</b>
```python
import json
import boto3
from botocore.exceptions import WaiterError

def wait_until_instance_stopped(ec2_client,instance_id):
    waiter = ec2_client.get_waiter('instance_stopped')
    
    try:
        waiter.wait(InstanceIds=[instance_id])
    except WaiterError as e:
        print(f'Error : {e}')

def lambda_handler(event, context):
    # TODO implement
    instance_id = event['instanceId']
    
    ec2_client = boto3.client('ec2')
    
    try:
        ec2_client.stop_instances(InstanceIds=[instance_id])
        wait_until_instance_stopped(ec2_client,instance_id)
        # ec2_client.modify_instance_attribute(InstanceId = instance_id,InstanceType={'Value':'t2.medium'})
        # ec2_client.start_instances(InstanceIds=[instance_id])
    except Exception as e:
        print(e)
```